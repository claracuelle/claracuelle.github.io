---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

interface Props {
  title?: string;
}

const { title = 'Autres rÃ©alisations' } = Astro.props;

const allProjects = await getCollection('projects');
const projectsSorted = allProjects
  .sort(
    (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
  )
  .slice(3, -1);
---

<section id='others' class='flex flex-col gap-8'>
  <h1
    class='container mx-auto px-3 font-migra underline underline-offset-8 decoration-expo-primary text-xl lg:text-3xl'
  >
    {title}
  </h1>
  <div class='w-screen overflow-hidden'>
    <div class='container mx-auto px-3 overflow-visible'>
      <swiper-container
        class='[&::part(container)]:overflow-visible'
        slides-per-view='1.5'
        space-between='40'
      >
        {
          projectsSorted.map((project) => {
            if (project.data.images.hero) {
              return (
                <swiper-slide>
                  <div class='flex flex-col gap-3'>
                    <Image
                      loading={'eager'}
                      class='w-full aspect-[300/180]'
                      width={300}
                      height={180}
                      src={project.data.images.hero.src}
                      alt={project.data.images.hero.alt}
                    />
                    <h1 class='font-black text-lg'>{project.data.title}</h1>
                    <div
                      class={`${project.data.tags.length === 0 ? 'hidden' : 'flex flex-wrap gap-2'}`}
                    >
                      {project.data.tags.map((tag) => (
                        <span class='text-expo-primary text-xs'>{tag}</span>
                      ))}
                    </div>
                  </div>
                </swiper-slide>
              );
            }
          })
        }
      </swiper-container>
    </div>
  </div>
</section>

<script>
  const $swiper = document.querySelector('#others swiper-container');
  (() => {
    if (window.innerWidth < 1024) {
      $swiper?.setAttribute('slides-per-view', '1.5');
      $swiper?.setAttribute('space-between', '20');
    } else {
      $swiper?.setAttribute('slides-per-view', '3.5');
      $swiper?.setAttribute('space-between', '40');
    }
  })();
  window.addEventListener('resize', () => {
    if (window.innerWidth < 1024) {
      $swiper?.setAttribute('slides-per-view', '1.5');
      $swiper?.setAttribute('space-between', '20');
    } else {
      $swiper?.setAttribute('slides-per-view', '3.5');
      $swiper?.setAttribute('space-between', '40');
    }
  });
</script>
